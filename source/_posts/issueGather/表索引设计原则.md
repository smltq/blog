---
title: 表索引设计原则
date: 2019-11-29 17:46:24
categories: 
- 数据库
tags:
- 设计
---

# 表索引设计原则

## 索引的优点

- 1.加快数据的检索速度，这是创建索引的最主要的原因;

- 2.通过创建唯一性索引，可以保证数据库表中每一行数据的唯一性;

- 3.加速表和表之间的连接;

- 4.在使用分组和排序子句进行数据检索时，可以显著减少查询中分组和排序的时间。

## 索引的缺点

- 1.创建索引和维护索引要耗费时间，这种时间随着数据量的增加而增加。

- 2.索引需要占物理空间，除了数据表占数据空间之外，每一个索引还要占一定的物理空间，如果要建立聚簇索引，那么需要的空间就会更大。

- 3.当对表中的数据进行增加、删除和修改的时候，索引也要同步动态的维护，这样就降低了数据的增删改速度。

所以单表数据太少，索引反而会影响速度；更新非常频繁的数据不适宜建索引

## 索引设计原则

根据数据库的功能，可以在数据库设计器中创建三种索引

- 唯一索引：唯一索引是不允许其中任何两行具有相同索引值的索引
- 主键索引：表定义主键将自动创建主键索引，主键索引是唯一索引的特定类型。该索引要求主键中的每个值都唯一。当在查询中使用主键索引时， 它允许对数据的快速访问
- 聚集索引：表中行的物理顺序与键值的逻辑（索引）顺序相同。一个表 只能包含一个聚集索引

>选择索引的最终目的是为了使查询的速度变快。下面给出的原则是最基本的准则，但不能拘泥于这些准则，应该根据应用的实际情况进行分析和判断，选择最合适的索引方式。

### 1.索引最左匹配原则

- 索引可以简单如一个列(a)，也可以复杂如多个列(a, b, c, d)，即联合索引。
- 如果是联合索引，那么key也由多个列组成，同时，索引只能用于查找key是否存在（相等），遇到范围查询(>、<、between、like左匹配)等就不能进一步匹配了，后续退化为线性查找。因此，列的排列顺序决定了可命中索引的列数。

例子：

如有索引(a, b, c, d)，查询条件a = 1 and b = 2 and c > 3 and d = 4，则会在每个节点依次命中a、b、c，无法命中d。(很简单：索引命中只能是相等的情况，不能是范围匹配)

> 明白最左匹配原则，对我们设计索引和编写高效SQL语句非常有帮助

### 2.为经常需要排序、分组操作的字段建立索引

经常需要ORDER BY、GROUP BY、DISTINCT等操作的字段，排序操作会浪费很多时间。如果为其建立索引，可以有效地避免排序操作。

>分组字段或者排序字段应该创建索引

### 3.为常作为查询条件的字段建立索引

如果某个字段经常用来做查询条件，那么该字段的查询速度会影响整个表的查询速度。因此，为这样的字段建立索引，可以提高整个表的查询速度。

> Where 子句中经常使用的字段应该创建索引

### 4.限制索引的数目

索引的数目不是越多越好。每个索引都需要占用磁盘空间，索引越多，需要的磁盘空间就越大。修改表时，对索引的重构和更新很麻烦。越多的索引，会使更新表变得很浪费时间。

### 5.尽量选择区分度高的列作为索引

尽量选择区分度高的列作为索引,区分度的公式是count(distinct col)/count(*)，表示字段不重复的比例，比例越大我们扫描的记录数越少，唯一键的区分度是1，而一些状态、性别字段可能在大数据面前区分度就是0，那可能有人会问，这个比例有什么经验值吗？使用场景不同，这个值也很难确定，一般需要join的字段我们都要求是0.1以上，即平均1条扫描10条记录

### 6.索引列不能参与计算

索引列不能参与计算，保持列“干净”，比如from_unixtime(create_time) = ’2019-12-02’就不能使用到索引，原因很简单，b+树中存的都是数据表中的字段值，但进行检索时，需要把所有元素都应用函数才能比较，显然成本太大。所以语句应该写成create_time = unix_timestamp(’2014-05-29’);

>即索引列不能带函数，否则会导致索引失效

### 7.扩展索引

尽量的扩展索引，不要新建索引。比如表中已经有a的索引，现在要加(a,b)的索引，那么只需要修改原来的索引即可

### 8.条件带like 注意事项

like 模糊查询中，右模糊查询(abc%)会使用索引，而(%abc)和(%abc%)会放弃索引而使用全表扫描

### 9.尽量使用数据量少的索引

如果索引的值很长，那么查询的速度会受到影响。例如，对一个CHAR(100)类型的字段进行全文检索需要的时间要比对CHAR(10)类型的字段需要的时间要多。

### 10.尽量使用前缀来索引

如果索引字段的值很长，最好使用值的前缀来索引。例如，TEXT和BLOG类型的字段，进行全文检索会很浪费时间。如果只检索字段的前面的若干个字符，这样可以提高检索速度。

### 11.删除不再使用或者很少使用的索引

表中的数据被大量更新，或者数据的使用方式被改变后，原有的一些索引可能不再需要。数据库管理员应当定期找出这些索引，将它们删除，从而减少索引对更新操作的影响。

### 12.=和in可以乱序。

比如a = 1 and b = 2 and c = 3 建立(a,b,c)索引可以任意顺序，mysql的查询优化器会帮你优化成索引可以识别的形式

### 13.联合查询

联合查询，子查询等多表操作时关连字段要加索引

## 资料

- [Java问题收集](https://github.com/smltq/blog/blob/master/source/_posts/issueGather/index.md)
- [原文地址](https://github.com/smltq/blog/blob/master/source/_posts/issueGather/%E8%A1%A8%E7%B4%A2%E5%BC%95%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99.md)
